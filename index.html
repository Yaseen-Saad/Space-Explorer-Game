<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Explorer | Interactive 3D Journey</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        .victory-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            text-align: center;
            animation: fadeIn 1s ease-in;
        }

        .victory-screen h1 {
            font-size: 48px;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            animation: scaleIn 1s ease-out;
        }

        .victory-screen p {
            font-size: 24px;
            margin-bottom: 30px;
            color: #fff;
            animation: slideUp 1s ease-out;
        }

        .victory-screen button {
            padding: 15px 30px;
            font-size: 20px;
            background: #4CAF50;
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: transform 0.2s, background 0.2s;
            animation: bounceIn 1s ease-out;
        }

        .victory-screen button:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .stats {
            margin: 20px 0;
            font-size: 18px;
            animation: fadeIn 1.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .firework {
            position: absolute;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    
    <div class="ui-overlay">
        <header class="game-header">
            <div class="logo">
                <i class="fas fa-rocket"></i>
                <span>Space Explorer</span>
            </div>
            <div class="stats">
                <div class="stat">
                    <i class="fas fa-star"></i>
                    <span id="score">0</span>
                </div>
                <div class="stat">
                    <i class="fas fa-gas-pump"></i>
                    <span id="fuel">100%</span>
                </div>
            </div>
        </header>

        <div class="mission-control" id="mission-control">
            <h2>Mission Control</h2>
            <p class="mission-text">Welcome, Space Explorer! Your mission is to discover and visit all space destinations. Use W,A,S,D to navigate and SPACE to boost.</p>
            <div class="objectives">
                <div class="objective" data-destination="moon">
                    <i class="fas fa-moon"></i>
                    <span>Lunar Base</span>
                    <div class="status">Not Visited</div>
                </div>
                <div class="objective" data-destination="mars">
                    <i class="fas fa-planet-mars"></i>
                    <span>Mars Colony</span>
                    <div class="status">Not Visited</div>
                </div>
                <div class="objective" data-destination="station">
                    <i class="fas fa-satellite"></i>
                    <span>Space Station</span>
                    <div class="status">Not Visited</div>
                </div>
            </div>
        </div>

        <div class="controls-hint">
            <div class="control-group">
                <div class="key">W</div>
                <span>Forward</span>
            </div>
            <div class="control-group">
                <div class="key">S</div>
                <span>Back</span>
            </div>
            <div class="control-group">
                <div class="key">A</div>
                <span>Left</span>
            </div>
            <div class="control-group">
                <div class="key">D</div>
                <span>Right</span>
            </div>
            <div class="control-group">
                <div class="key">E</div>
                <span>Up</span>
            </div>
            <div class="control-group">
                <div class="key">Shift</div>
                <span>Down</span>
            </div>
            <div class="control-group">
                <div class="key">Q</div>
                <span>Stabilize</span>
            </div>
            <div class="control-group">
                <div class="key wide">SPACE</div>
                <span>Boost</span>
            </div>
        </div>

        <div id="destination-info" class="destination-info hidden">
            <h3>Destination Reached!</h3>
            <div class="destination-content">
                <img src="" alt="Destination" id="destination-image">
                <div class="destination-details">
                    <h4 id="destination-name"></h4>
                    <p id="destination-description"></p>
                    <div class="destination-stats">
                        <div class="stat">
                            <i class="fas fa-clock"></i>
                            <span id="destination-time"></span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-temperature-high"></i>
                            <span id="destination-temp"></span>
                        </div>
                    </div>
                </div>
            </div>
            <button class="continue-btn">Continue Exploration</button>
        </div>
    </div>

    <div id="start-screen" class="start-screen">
        <div class="start-content">
            <h1>Space Explorer</h1>
            <p>Embark on an interactive 3D journey through space</p>
            <div class="tutorial-steps">
                <div class="tutorial-step active" data-step="1">
                    <h3>Welcome to Space Explorer!</h3>
                    <p>Your mission is to visit all space destinations while managing your fuel efficiently.</p>
                    <button class="tutorial-next">Next</button>
                </div>
                <div class="tutorial-step" data-step="2">
                    <h3>Controls</h3>
                    <div class="controls-guide">
                        <div class="control-group">
                            <div class="key">W</div>
                            <span>Forward</span>
                        </div>
                        <div class="control-group">
                            <div class="key">S</div>
                            <span>Back</span>
                        </div>
                        <div class="control-group">
                            <div class="key">A</div>
                            <span>Left</span>
                        </div>
                        <div class="control-group">
                            <div class="key">D</div>
                            <span>Right</span>
                        </div>
                        <div class="control-group">
                            <div class="key">E</div>
                            <span>Up</span>
                        </div>
                        <div class="control-group">
                            <div class="key">Shift</div>
                            <span>Down</span>
                        </div>
                        <div class="control-group">
                            <div class="key">Q</div>
                            <span>Stabilize</span>
                        </div>
                        <div class="control-group">
                            <div class="key wide">SPACE</div>
                            <span>Boost</span>
                        </div>
                    </div>
                    <button class="tutorial-next">Next</button>
                </div>
                <div class="tutorial-step" data-step="3">
                    <h3>Game Objectives</h3>
                    <ul class="objective-list">
                        <li><i class="fas fa-check-circle"></i> Visit all space destinations</li>
                        <li><i class="fas fa-gas-pump"></i> Manage your fuel wisely</li>
                        <li><i class="fas fa-star"></i> Collect points for each destination</li>
                        <li><i class="fas fa-trophy"></i> Complete the mission as fast as possible</li>
                    </ul>
                    <button class="tutorial-next">Next</button>
                </div>
                <div class="tutorial-step" data-step="4">
                    <h3>Choose Your Difficulty</h3>
                    <div class="difficulty-info">
                        <div class="difficulty-card" data-difficulty="easy">
                            <h4>Easy</h4>
                            <ul>
                                <li>More Fuel</li>
                                <li>Slower Movement</li>
                                <li>Larger Collision Range</li>
                            </ul>
                        </div>
                        <div class="difficulty-card" data-difficulty="medium">
                            <h4>Medium</h4>
                            <ul>
                                <li>Standard Fuel</li>
                                <li>Normal Movement</li>
                                <li>Normal Collision Range</li>
                            </ul>
                        </div>
                        <div class="difficulty-card" data-difficulty="hard">
                            <h4>Hard</h4>
                            <ul>
                                <li>Limited Fuel</li>
                                <li>Faster Movement</li>
                                <li>Precise Collision Required</li>
                            </ul>
                        </div>
                    </div>
                    <button class="tutorial-next">Start Game</button>
                </div>
            </div>
            <div class="difficulty-select">
                <button class="difficulty-btn" data-difficulty="easy">Easy</button>
                <button class="difficulty-btn" data-difficulty="medium">Medium</button>
                <button class="difficulty-btn" data-difficulty="hard">Hard</button>
            </div>
        </div>
    </div>

    <!-- Add Help Button -->
    <button class="help-button" id="helpButton">
        <i class="fas fa-question-circle"></i>
    </button>

    <!-- Add Help Modal -->
    <div class="help-modal hidden" id="helpModal">
        <div class="help-content">
            <h2>Game Help</h2>
            <div class="help-sections">
                <div class="help-section">
                    <h3>Basic Controls</h3>
                    <div class="controls-guide">
                        <div class="control-group">
                            <div class="key">W</div>
                            <span>Forward</span>
                        </div>
                        <div class="control-group">
                            <div class="key">S</div>
                            <span>Backward</span>
                        </div>
                        <div class="control-group">
                            <div class="key">A</div>
                            <span>Left</span>
                        </div>
                        <div class="control-group">
                            <div class="key">D</div>
                            <span>Right</span>
                        </div>
                        <div class="control-group">
                            <div class="key wide">SPACE</div>
                            <span>Boost</span>
                        </div>
                    </div>
                </div>
                <div class="help-section">
                    <h3>Tips</h3>
                    <ul class="tips-list">
                        <li>Use boost sparingly to conserve fuel</li>
                        <li>Look for the glowing indicator when near a destination</li>
                        <li>Keep an eye on your fuel gauge</li>
                        <li>Visit closer destinations first</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h3>Destinations</h3>
                    <div class="destination-guide">
                        <div class="destination-item">
                            <i class="fas fa-moon"></i>
                            <span>Lunar Base (Closest)</span>
                        </div>
                        <div class="destination-item">
                            <i class="fas fa-satellite"></i>
                            <span>Space Station (Medium)</span>
                        </div>
                        <div class="destination-item">
                            <i class="fas fa-planet-mars"></i>
                            <span>Mars Colony (Farthest)</span>
                        </div>
                    </div>
                </div>
            </div>
            <button class="close-help">Close</button>
        </div>
    </div>

    <div class="victory-screen" id="victory-screen">
        <h1>Mission Accomplished!</h1>
        <p>Congratulations, Space Explorer!</p>
        <div class="stats">
            <p>Time Elapsed: <span id="completion-time">0:00</span></p>
            <p>Fuel Remaining: <span id="final-fuel">0</span>%</p>
            <p>Destinations Visited: <span id="destinations-count">0</span></p>
        </div>
        <button onclick="restartGame()">Play Again</button>
    </div>

    <script>
        // Game state
        const gameState = {
            active: false,
            fuel: 100,
            startTime: null,
            completionTime: null,
            destinationsVisited: new Set(),
            boostCost: 0.5,  // Fuel cost per boost frame
            movementCost: 0.1  // Fuel cost per movement frame
        };

        // Initialize Three.js scene
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('game-container').appendChild(renderer.domElement);

        // Game settings
        let speed = 0.2;
        let collisionRange = 5;

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x404040);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(5, 3, 5);
        scene.add(ambientLight);
        scene.add(directionalLight);

        // Spaceship
        const shipGeometry = new THREE.ConeGeometry(1, 4, 8);
        const shipMaterial = new THREE.MeshPhongMaterial({ color: 0x6C63FF });
        const spaceship = new THREE.Mesh(shipGeometry, shipMaterial);
        scene.add(spaceship);

        // Create stars
        const starsGeometry = new THREE.BufferGeometry();
        const starsMaterial = new THREE.PointsMaterial({ color: 0xFFFFFF, size: 0.1 });
        const starsVertices = [];
        for(let i = 0; i < 10000; i++) {
            const x = (Math.random() - 0.5) * 2000;
            const y = (Math.random() - 0.5) * 2000;
            const z = (Math.random() - 0.5) * 2000;
            starsVertices.push(x, y, z);
        }
        starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
        const stars = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(stars);

        // Create destinations
        const destinations = [
            {
                name: 'Lunar Base',
                position: new THREE.Vector3(20, 0, 20),
                geometry: new THREE.SphereGeometry(3, 32, 32),
                material: new THREE.MeshPhongMaterial({ 
                    color: 0xCCCCCC,
                    emissive: 0x444444,
                    emissiveIntensity: 0
                }),
                description: 'Earth\'s first permanent lunar settlement',
                time: '3 Days',
                temperature: '-153°C to 107°C'
            },
            {
                name: 'Mars Colony',
                position: new THREE.Vector3(-30, 10, -20),
                geometry: new THREE.SphereGeometry(4, 32, 32),
                material: new THREE.MeshPhongMaterial({ 
                    color: 0xE67E22,
                    emissive: 0x444444,
                    emissiveIntensity: 0
                }),
                description: 'Humanity\'s first interplanetary colony',
                time: '8 Months',
                temperature: '-140°C to 20°C'
            },
            {
                name: 'Space Station',
                position: new THREE.Vector3(0, 25, -15),
                geometry: new THREE.BoxGeometry(5, 2, 2),
                material: new THREE.MeshPhongMaterial({ 
                    color: 0x95A5A6,
                    emissive: 0x444444,
                    emissiveIntensity: 0
                }),
                description: 'International research facility in low Earth orbit',
                time: '1 Week',
                temperature: '-157°C to 121°C'
            }
        ];

        // Add destinations to scene
        destinations.forEach(dest => {
            dest.mesh = new THREE.Mesh(dest.geometry, dest.material);
            dest.mesh.position.copy(dest.position);
            scene.add(dest.mesh);
        });

        // Camera position
        camera.position.z = 15;
        camera.position.y = 5;

        // Movement controls
        const keys = {
            w: false,
            a: false,
            s: false,
            d: false,
            space: false,
            shift: false,  // Added for downward movement
            e: false,      // Added for upward movement
            q: false      // Added for stabilize
        };

        // Velocity vector for smooth movement
        const velocity = new THREE.Vector3();

        // Event Listeners for movement
        window.addEventListener('keydown', (e) => {
            if (gameState.active) {
                switch(e.key.toLowerCase()) {
                    case 'w': keys.w = true; break;
                    case 'a': keys.a = true; break;
                    case 's': keys.s = true; break;
                    case 'd': keys.d = true; break;
                    case ' ': keys.space = true; e.preventDefault(); break;
                    case 'shift': keys.shift = true; break;
                    case 'e': keys.e = true; break;
                    case 'q': keys.q = true; break;
                }
            }
        });

        window.addEventListener('keyup', (e) => {
            switch(e.key.toLowerCase()) {
                case 'w': keys.w = false; break;
                case 'a': keys.a = false; break;
                case 's': keys.s = false; break;
                case 'd': keys.d = false; break;
                case ' ': keys.space = false; break;
                case 'shift': keys.shift = false; break;
                case 'e': keys.e = false; break;
                case 'q': keys.q = false; break;
            }
        });

        // Tutorial System
        let currentTutorialStep = 1;
        const totalTutorialSteps = 4;

        function showTutorialStep(step) {
            document.querySelectorAll('.tutorial-step').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelector(`.tutorial-step[data-step="${step}"]`).classList.add('active');
        }

        // Initialize tutorial buttons
        document.querySelectorAll('.tutorial-next').forEach(button => {
            button.addEventListener('click', () => {
                if (currentTutorialStep < totalTutorialSteps) {
                    currentTutorialStep++;
                    showTutorialStep(currentTutorialStep);
                } else {
                    document.getElementById('start-screen').style.display = 'none';
                    gameState.active = true;
                    gameState.startTime = Date.now();
                    showGameTip('Use E to move up and SHIFT to move down!');
                }
            });
        });

        // Difficulty selection
        const difficultySettings = {
            easy: {
                fuel: 150,
                speed: 0.15,
                collisionRange: 7,
                boostCost: 0.3
            },
            medium: {
                fuel: 100,
                speed: 0.2,
                collisionRange: 5,
                boostCost: 0.5
            },
            hard: {
                fuel: 75,
                speed: 0.25,
                collisionRange: 3,
                boostCost: 0.7
            }
        };

        // Initialize difficulty buttons
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                const difficulty = e.target.dataset.difficulty;
                updateGameDifficulty(difficulty);
            });
        });

        function updateGameDifficulty(difficulty) {
            const settings = difficultySettings[difficulty];
            gameState.fuel = settings.fuel;
            speed = settings.speed;
            collisionRange = settings.collisionRange;
            gameState.boostCost = settings.boostCost;
            document.getElementById('fuel').textContent = Math.round(gameState.fuel) + '%';
        }

        // Help system
        const helpButton = document.getElementById('helpButton');
        const helpModal = document.getElementById('helpModal');
        const closeHelp = document.querySelector('.close-help');

        helpButton.addEventListener('click', () => {
            helpModal.classList.remove('hidden');
            gameState.active = false;
        });

        closeHelp.addEventListener('click', () => {
            helpModal.classList.add('hidden');
            gameState.active = true;
        });

        // Game tips
        function showGameTip(message, duration = 3000) {
            const tip = document.createElement('div');
            tip.className = 'game-tip';
            tip.textContent = message;
            document.body.appendChild(tip);

            setTimeout(() => {
                tip.classList.add('fade-out');
                setTimeout(() => tip.remove(), 500);
            }, duration);
        }

        // Destination info handlers
        function showDestinationInfo(destination) {
            const infoPanel = document.getElementById('destination-info');
            document.getElementById('destination-name').textContent = destination.name;
            document.getElementById('destination-description').textContent = destination.description;
            document.getElementById('destination-time').textContent = destination.time;
            document.getElementById('destination-temp').textContent = destination.temperature;
            infoPanel.classList.remove('hidden');
            gameState.active = false;
        }

        // Initialize continue button
        document.querySelector('.continue-btn').addEventListener('click', () => {
            document.getElementById('destination-info').classList.add('hidden');
            gameState.active = true;
        });

        function updateObjectives() {
            document.querySelectorAll('.objective').forEach(obj => {
                const destName = obj.querySelector('span').textContent;
                if (gameState.destinationsVisited.has(destName)) {
                    obj.querySelector('.status').textContent = 'Visited';
                    obj.classList.add('completed');
                }
            });
        }

        // Update proximity indicators
        function updateProximityIndicator() {
            destinations.forEach(dest => {
                if (!gameState.destinationsVisited.has(dest.name)) {
                    const distance = spaceship.position.distanceTo(dest.mesh.position);
                    if (distance < 20) {
                        const intensity = 1 - (distance / 20);
                        dest.mesh.material.emissiveIntensity = intensity;
                    } else {
                        dest.mesh.material.emissiveIntensity = 0;
                    }
                }
            });
        }

        // Game loop
        function animate() {
            requestAnimationFrame(animate);

            if (gameState.active) {
                let moving = false;
                
                // Movement and fuel consumption
                if (keys.w || keys.s || keys.a || keys.d || keys.e || keys.shift) {
                    moving = true;
                    updateFuel(gameState.movementCost);
                }

                // Movement
                if (keys.w) velocity.z -= speed;
                if (keys.s) velocity.z += speed;
                if (keys.a) velocity.x -= speed;
                if (keys.d) velocity.x += speed;
                if (keys.e) velocity.y += speed;  // Up movement
                if (keys.shift) velocity.y -= speed;  // Down movement
                
                // Boost handling
                if (keys.space && gameState.fuel > 0) {
                    velocity.multiplyScalar(1.5);
                    updateFuel(gameState.boostCost);
                }

                // Stabilize movement (slow down gradually when Q is pressed)
                if (keys.q) {
                    velocity.multiplyScalar(0.9);
                    if (moving) {
                        updateFuel(gameState.movementCost / 2); // Half cost for stabilizing
                    }
                }

                // Apply velocity with damping
                spaceship.position.add(velocity);
                velocity.multiplyScalar(0.98);

                // Add slight gravity effect when not actively moving up/down
                if (!keys.e && !keys.shift && !keys.q) {
                    velocity.y -= 0.01;
                }

                // Prevent going below ground level
                if (spaceship.position.y < 0) {
                    spaceship.position.y = 0;
                    velocity.y = 0;
                }

                // Rotate ship based on movement
                if (velocity.length() > 0.01) {
                    const targetRotation = new THREE.Quaternion();
                    const up = new THREE.Vector3(0, 1, 0);
                    const direction = velocity.clone().normalize();
                    
                    // Create rotation matrix
                    const lookMatrix = new THREE.Matrix4();
                    lookMatrix.lookAt(new THREE.Vector3(0, 0, 0), direction, up);
                    targetRotation.setFromRotationMatrix(lookMatrix);
                    
                    // Smooth rotation
                    spaceship.quaternion.slerp(targetRotation, 0.1);
                }

                // Check collisions with destinations
                destinations.forEach(dest => {
                    if (!gameState.destinationsVisited.has(dest.name)) {
                        const distance = spaceship.position.distanceTo(dest.mesh.position);
                        if (distance < collisionRange) {
                            gameState.destinationsVisited.add(dest.name);
                            gameState.score += 100;
                            document.getElementById('score').textContent = gameState.score;
                            showDestinationInfo(dest);
                            updateObjectives();
                        }
                    }
                });

                // Update proximity indicators
                updateProximityIndicator();

                // Show low fuel warning
                if (gameState.fuel < 20 && !gameState.lowFuelWarning) {
                    gameState.lowFuelWarning = true;
                    showGameTip('Warning: Low Fuel!', 3000);
                }

                // Update nearest destination info
                const closestDest = destinations.reduce((prev, curr) => {
                    const distance = spaceship.position.distanceTo(curr.mesh.position);
                    return distance < prev.distance ? { name: curr.name, distance } : prev;
                }, { distance: Infinity });

                document.querySelector('.mission-text').textContent = 
                    `Nearest Destination: ${closestDest.name} (${Math.round(closestDest.distance)} units away)`;

                // Update camera to follow ship with better angle for vertical movement
                const cameraOffset = new THREE.Vector3(0, 5, 15);
                const targetCameraPos = spaceship.position.clone().add(cameraOffset);
                camera.position.lerp(targetCameraPos, 0.1);
                camera.lookAt(spaceship.position);

                // Check for victory
                checkVictory();
            }

            renderer.render(scene, camera);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Set initial difficulty
        updateGameDifficulty('medium');

        // Start tutorial
        showTutorialStep(1);

        // Start animation loop
        animate();

        // Add victory check function
        function checkVictory() {
            if (gameState.active && gameState.destinationsVisited.size === destinations.length) {
                gameState.active = false;
                gameState.completionTime = (Date.now() - gameState.startTime) / 1000;
                showVictoryScreen();
            }
        }

        // Victory celebration
        function showVictoryScreen() {
            const victoryScreen = document.getElementById('victory-screen');
            victoryScreen.style.display = 'flex';

            // Update stats
            document.getElementById('completion-time').textContent = formatTime(gameState.completionTime);
            document.getElementById('final-fuel').textContent = Math.round(gameState.fuel);
            document.getElementById('destinations-count').textContent = gameState.destinationsVisited.size;

            // Create fireworks
            createFireworks();
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function createFireworks() {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * window.innerWidth + 'px';
                    firework.style.top = Math.random() * window.innerHeight + 'px';
                    firework.style.width = '5px';
                    firework.style.height = '5px';
                    firework.style.borderRadius = '50%';
                    firework.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    firework.style.boxShadow = '0 0 20px currentColor';
                    document.body.appendChild(firework);

                    // Animate
                    const angle = Math.random() * Math.PI * 2;
                    const velocity = 10 + Math.random() * 10;
                    const dx = Math.cos(angle) * velocity;
                    const dy = Math.sin(angle) * velocity;
                    
                    let x = parseInt(firework.style.left);
                    let y = parseInt(firework.style.top);
                    let opacity = 1;

                    const animate = () => {
                        x += dx;
                        y += dy;
                        opacity -= 0.02;
                        
                        firework.style.left = x + 'px';
                        firework.style.top = y + 'px';
                        firework.style.opacity = opacity;

                        if (opacity > 0) {
                            requestAnimationFrame(animate);
                        } else {
                            firework.remove();
                        }
                    };
                    
                    animate();
                }, i * 200);
            }
        }

        function updateFuel(cost) {
            if (gameState.active && gameState.fuel > 0) {
                gameState.fuel = Math.max(0, gameState.fuel - cost);
                document.getElementById('fuel').textContent = Math.round(gameState.fuel) + '%';
                
                // Low fuel warning
                if (gameState.fuel < 20 && !gameState.lowFuelWarning) {
                    gameState.lowFuelWarning = true;
                    showGameTip('Warning: Low Fuel!', 3000);
                }
            }
        }

        function restartGame() {
            // Reset game state
            gameState.active = true;
            gameState.fuel = 100;
            gameState.startTime = Date.now();
            gameState.destinationsVisited.clear();
            gameState.lowFuelWarning = false;
            
            // Reset spaceship position
            spaceship.position.set(0, 0, 0);
            velocity.set(0, 0, 0);
            
            // Reset camera
            camera.position.set(0, 5, 15);
            camera.lookAt(spaceship.position);
            
            // Hide victory screen
            document.getElementById('victory-screen').style.display = 'none';
            
            // Reset UI
            document.getElementById('fuel').textContent = '100%';
            document.getElementById('destination-info').textContent = '';
            
            // Reset destination status displays
            destinations.forEach(dest => {
                const destElement = document.querySelector(`[data-destination="${dest.name}"]`);
                if (destElement) {
                    destElement.textContent = 'Not Visited';
                    destElement.style.color = '';
                }
            });
            
            // Show initial tip
            showGameTip('Use E to move up and SHIFT to move down!', 5000);
        }
    </script>
</body>
</html>